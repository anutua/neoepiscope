<tool id="neoepiscopeWrapper2" name="neoepiscope" version="0.1.0" python_template_version="3.5">
    
    <requirements>
    </requirements>

    <!--Specify the command to be passed to terminal based on the user inputs for neoepiscope. Runs neoepiscope index and neoepiscope call-->
    <command><![CDATA[ 

        #if str($name3.build)=="uploadBuild": 
        neoepiscope index
        -g "${GTF}" -d "${dict_path}"
        #end if

        #if str($name1.hapCUT2_OUTPUT=="No" ):
            #if str($name1.hapCUT2_OUTPUT.somatic_vcf):
                #if str($name1.hapCUT2_OUTPUT.somatic_vcf.germline_option)=="Yes":
                        #if str($name1.hapCUT2_OUTPUT.somatic_vcf.germline_option.germline_vcf):
                        -neoepiscope merge -g "${germline_vcf}" "${somatic_vcf}" -o "${merged_vcf}"
                        #end if
                #end if    
            #end if
        #end if



        #if str($name1.hapCUT2_OUTPUT)=="Yes" :
        neoepiscope call
        -c "${merged_hapCUT2_OUTPUT}" 
             
            #if str($name2.affinity)=="No": 
            --no-affinity 
            #else if str($name2.affinity)=="Yes":
            -p "${affinity_predictor_name}" "${affinity_predictor_version}" "${affinity_predictor_score}" -a "${alleles}"
            #end if

            #if str($name3.build)=="hg19":
            -b hg19
            #end if
            #if str($name3.build)=="GRCh38": 
            -b GRCh38
            #end if

            #if str($kmer)!="default":
            -k "${kmer}"
            #end if
        #end if
        
        -o $output
        2>/dev/null
    ]]>
    </command>
    <inputs>
        <!--genome build options-->
        <conditional name="name3">
            <param name="build" type="select" label="Please select your preferred genome build from the drop down list." >
                <option value="hg19">hg19</option>
                <option value="GRCh38">GRCh38</option>
                <option value="uploadBuild">Upload genome build</option>
            </param>
            <when value="uploadBuild">
                <param name="GTF" type="data" label="Upload your GTF" />
            </when>
        </conditional>

        <!--vcf processing inputs-->
        <conditional name="name1">
            <param name="hapCUT2_OUTPUT" type="boolean" truevalue="Yes" falsevalue="No" label="Do you already have a hapCUT2 processed output from your somatic vcf file? " />
            <when value="Yes">
                <param name="merged_hapCUT2_OUTPUT" type="data" label="Input hapCUT2 output from your vcf file" />
            </when>
            <when value="No">
                <param name="somatic_vcf" type="data" format="vcf" label="Input your somatic vcf file for processing." />
                
                <conditional>
                    <param name="germline_option" type="boolean" truevalue="Yes" falsevalue="No" label="Would you like to include germline variation in the neoepitope prediction? Choosing Yes would require a germline vcf file" />
                        <when value="No"/>
                        <when value="Yes">
                            <param name="germline_vcf" type="data" format="vcf" label="Input your germline vcf file for processing." />
                        </when> 
            </conditional>
            </when>
        </conditional>

        <conditional name="name2">
            <param name="affinity" type="boolean" truevalue="Yes" falsevalue="No" label="Should binding affinity be calculated?" />
            <when value="Yes">
                <param name="affinity_predictor_name" type="select" label="Select your software" />
                <param name="affinity_predictor_version" type="select" label="Select its version number" />
                <param name="affinity_predictor_score" type="select" label="Select its score" />
                <param name="alleles" type="data" format="csv" label="Binding affinity predictors require a list of alleles. Please upload your allele file in csv format" />                
            </when>
        </conditional>
        
        <param name="kmer" type="select" label="Select your preferred k-mer size from the drop down list." >
                <option value="default">default</option>
                <option value="80">80</option>
                <option value="100">100</option>
        </param>

    </inputs>
    <outputs>
        <data name="dict_path" label="pickled dictionaries" />
            <filter>$name3.build=="uploadBuild"</filter>
        <data name="output" format="tsv" label="Neoepitopes found" />
    </outputs>
    <help><![CDATA[
       Wraps 
    ]]></help>

</tool>

